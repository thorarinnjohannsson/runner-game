<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <!-- Safe area support for notched devices -->
    <style>
        :root {
            --safe-area-inset-top: env(safe-area-inset-top, 0px);
            --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
            --safe-area-inset-left: env(safe-area-inset-left, 0px);
            --safe-area-inset-right: env(safe-area-inset-right, 0px);
        }
    </style>
    <!-- PWA / Mobile Web App -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Animal Jump">
    <meta name="application-name" content="Animal Jump">
    <meta name="msapplication-TileColor" content="#6ABE30">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <meta name="theme-color" content="#6ABE30" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#6ABE30" media="(prefers-color-scheme: dark)">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Primary Meta Tags -->
    <title>Animal Jump - Fun Pixel Art Runner Game</title>
    <meta name="title" content="Animal Jump - Fun Pixel Art Runner Game">
    <meta name="description" content="Jump, run, and dodge obstacles in this fun pixel-art endless runner game! Choose from 5 adorable animal characters and compete for high scores. Play free in your browser!">
    <meta name="keywords" content="animal jump, runner game, pixel art game, endless runner, browser game, free game, jump game, animal game, retro game">
    <meta name="author" content="Animal Jump">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://thorarinnjohannsson.github.io/runner-game/">
    <meta property="og:title" content="Animal Jump - Fun Pixel Art Runner Game">
    <meta property="og:description" content="Jump, run, and dodge obstacles in this fun pixel-art endless runner game! Choose from 5 adorable animal characters and compete for high scores. Play free in your browser!">
    <meta property="og:image" content="https://thorarinnjohannsson.github.io/runner-game/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="640">
    <meta property="og:image:alt" content="Animal Jump game screenshot showing pixel-art characters and gameplay">
    <meta property="og:site_name" content="Animal Jump">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://thorarinnjohannsson.github.io/runner-game/">
    <meta name="twitter:title" content="Animal Jump - Fun Pixel Art Runner Game">
    <meta name="twitter:description" content="Jump, run, and dodge obstacles in this fun pixel-art endless runner game! Choose from 5 adorable animal characters and compete for high scores. Play free in your browser!">
    <meta name="twitter:image" content="https://thorarinnjohannsson.github.io/runner-game/og-image.png">
    <meta name="twitter:image:alt" content="Animal Jump game screenshot showing pixel-art characters and gameplay">
    
    <!-- Additional SEO -->
    <link rel="canonical" href="https://thorarinnjohannsson.github.io/runner-game/">
    
    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "VideoGame",
      "name": "Animal Jump",
      "description": "Jump, run, and dodge obstacles in this fun pixel-art endless runner game! Choose from 5 adorable animal characters and compete for high scores.",
      "url": "https://thorarinnjohannsson.github.io/runner-game/",
      "image": "https://thorarinnjohannsson.github.io/runner-game/og-image.png",
      "genre": "Arcade, Runner, Platform",
      "gamePlatform": "Web Browser",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "ratingCount": "100"
      },
      "applicationCategory": "Game",
      "browserRequirements": "Requires JavaScript. Requires HTML5."
    }
    </script>
    
    <!-- Favicons and Icons -->
    <link rel="icon" type="image/svg+xml" href="favicon-wolfie.svg">
    <link rel="alternate icon" href="favicon-wolfie.svg">
    
    <!-- Apple Touch Icons (for iOS home screen) -->
    <link rel="apple-touch-icon" href="app-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="app-icon.png">
    <link rel="apple-touch-icon" sizes="152x152" href="app-icon.png">
    <link rel="apple-touch-icon" sizes="144x144" href="app-icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="app-icon.png">
    <link rel="apple-touch-icon" sizes="114x114" href="app-icon.png">
    <link rel="apple-touch-icon" sizes="76x76" href="app-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="app-icon.png">
    <link rel="apple-touch-icon" sizes="60x60" href="app-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="app-icon.png">
    
    <!-- Android Chrome Icons -->
    <link rel="icon" type="image/svg+xml" sizes="192x192" href="favicon-wolfie.svg">
    <link rel="icon" type="image/svg+xml" sizes="512x512" href="favicon-wolfie.svg">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-C5T0TNH3H2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-C5T0TNH3H2');
    </script>
    
    <!-- Google Fonts: Press Start 2P -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <!-- Styles loaded dynamically by loader script to prevent caching -->
</head>
<body>
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <input type="text" id="playerNameInput" placeholder="Enter your name" maxlength="12" autocomplete="off">
        <div id="version-info"></div>
        <div id="player-stats"></div>
    </div>

    <!-- Auto-loader: Forces fresh files every reload for testing -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        (function() {
            // Generate a unique version number based on the current time
            var v = Date.now();
            
            // Load and display version info
            var versionDiv = document.getElementById('version-info');
            if (versionDiv) {
                // Try to load version.json, fallback to timestamp
                fetch('version.json?v=' + v)
                    .then(function(response) {
                        if (response.ok) {
                            return response.json();
                        }
                        throw new Error('Version file not found');
                    })
                    .then(function(versionInfo) {
                        // Format commit date
                        var commitDate = new Date(versionInfo.date);
                        var dateStr = commitDate.toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric', 
                            year: 'numeric' 
                        });
                        var timeStr = commitDate.toLocaleTimeString('en-US', { 
                            hour: '2-digit', 
                            minute: '2-digit',
                            hour12: true
                        });
                        
                        // Display: version number | date time
                        versionDiv.textContent = 'v' + versionInfo.version + ' • ' + dateStr + ' ' + timeStr;
                    })
                    .catch(function(error) {
                        // Fallback to timestamp if version.json not available
                        var buildDate = new Date(v);
                        var dateStr = buildDate.toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric', 
                            year: 'numeric' 
                        });
                        var timeStr = buildDate.toLocaleTimeString('en-US', { 
                            hour: '2-digit', 
                            minute: '2-digit',
                            hour12: true
                        });
                        versionDiv.textContent = 'dev • ' + dateStr + ' ' + timeStr;
                    });
            } 

            // 1. Load CSS with version
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'styles.css?v=' + v;
            document.head.appendChild(link);

            // 2. List of scripts to load in order
            var scripts = [
                "js/analytics.js",
                "js/mobile.js",
                "js/supabase-client.js",
                "js/player-stats.js",
                "js/themes.js",
                "js/level.js",
                "js/effects.js",
                "js/transitions.js",
                "js/background.js",
                "js/characters.js",
                "js/scoring.js",
                "js/player.js",
                "js/obstacle.js",
                "js/input.js",
                "js/collision.js",
                "js/difficulty.js",
                "js/storage.js",
                "js/audio.js",
                "js/zoom.js",
                "js/ui.js",
                "js/main.js"
            ];

            // 3. Load scripts sequentially to ensure correct order
            function loadNext(index) {
                if (index >= scripts.length) return;
                
                var script = document.createElement('script');
                script.src = scripts[index] + '?v=' + v;
                script.onload = function() { loadNext(index + 1); };
                document.body.appendChild(script);
            }
            
            // Start loading
            loadNext(0);
        })();
    </script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Register service worker for PWA support (offline capability and "Add to Home Screen")
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/runner-game/service-worker.js')
                    .then(registration => {
                        console.log('[PWA] Service Worker registered successfully:', registration.scope);
                        
                        // Check for updates periodically
                        setInterval(() => {
                            registration.update();
                        }, 60000); // Check every minute
                        
                        // Listen for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('[PWA] New version available! Refresh to update.');
                                    // Optionally show user a notification about update
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('[PWA] Service Worker registration failed:', error);
                    });
            });
        } else {
            console.log('[PWA] Service Workers are not supported in this browser');
        }
    </script>
</body>
</html>