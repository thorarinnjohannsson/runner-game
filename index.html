<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-fullscreen">
    <title>Animal Jump</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='%236ABE30'/><rect x='20' y='8' width='8' height='8' fill='%23FF8C42'/><rect x='16' y='14' width='10' height='6' fill='%23FF8C42'/><rect x='18' y='20' width='2' height='6' fill='%23FF8C42'/><rect x='24' y='20' width='2' height='6' fill='%23FF8C42'/><rect x='14' y='16' width='3' height='2' fill='%23FF8C42'/><rect x='22' y='10' width='2' height='2' fill='%232C3E50'/><rect x='8' y='18' width='4' height='1' fill='%23D2B48C' opacity='0.6'/><rect x='4' y='20' width='4' height='1' fill='%23D2B48C' opacity='0.5'/><rect x='2' y='22' width='3' height='1' fill='%23D2B48C' opacity='0.4'/></svg>">
    
  <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TZ35GHWW');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Google Fonts: Press Start 2P -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <!-- Styles loaded dynamically by loader script to prevent caching -->
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TZ35GHWW"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <input type="text" id="playerNameInput" placeholder="Enter your name" maxlength="12" autocomplete="off">
        <div id="version-info"></div>
        <div id="player-stats"></div>
    </div>

    <!-- Auto-loader: Forces fresh files every reload for testing -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        (function() {
            // Generate a unique version number based on the current time
            var v = Date.now();
            
            // Set version info with timestamp
            var versionDiv = document.getElementById('version-info');
            if (versionDiv) {
                var buildDate = new Date(v);
                var dateStr = buildDate.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric', 
                    year: 'numeric' 
                });
                var timeStr = buildDate.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: true
                });
                versionDiv.textContent =  dateStr + ' ' + timeStr;
            } 

            // 1. Load CSS with version
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'styles.css?v=' + v;
            document.head.appendChild(link);

            // 2. List of scripts to load in order
            var scripts = [
                "js/analytics.js",
                "js/mobile.js",
                "js/supabase-client.js",
                "js/player-stats.js",
                "js/themes.js",
                "js/level.js",
                "js/effects.js",
                "js/transitions.js",
                "js/background.js",
                "js/characters.js",
                "js/scoring.js",
                "js/player.js",
                "js/obstacle.js",
                "js/input.js",
                "js/collision.js",
                "js/difficulty.js",
                "js/storage.js",
                "js/audio.js",
                "js/ui.js",
                "js/main.js"
            ];

            // 3. Load scripts sequentially to ensure correct order
            function loadNext(index) {
                if (index >= scripts.length) return;
                
                var script = document.createElement('script');
                script.src = scripts[index] + '?v=' + v;
                script.onload = function() { loadNext(index + 1); };
                document.body.appendChild(script);
            }
            
            // Start loading
            loadNext(0);
        })();
    </script>
</body>
</html>